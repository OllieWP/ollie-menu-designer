import{getContext as e,getElement as t,store as n,withScope as s,withSyncEvent as o}from"@wordpress/interactivity";const i=300,c=2,l=200,u=400,a=1,r="rgba(255, 255, 255, 1)",d=".wp-block-ollie-mega-menu__menu-container",p=".wp-block-navigation",m=".wp-block-navigation__responsive-container",f=e=>e.querySelector(d),g=(e,t)=>e.classList.contains({custom:"menu-width-custom",content:"menu-width-content",wide:"menu-width-wide",full:"menu-width-full"}[t]);let M=null;const{state:h,actions:v}=n("ollie/mega-menu",{state:{get isMenuOpen(){return Object.values(h.menuOpenedBy).filter(Boolean).length>0},get menuOpenedBy(){return e().menuOpenedBy},get isDesktop(){return window.innerWidth>=600},hoverTimeout:null,get dynamicHoverDelay(){const t=(e().topSpacing||0)*c;return i+t},isProcessingClick:!1},actions:{closeAllMenus(){v.closeMenu("click"),v.closeMenu("focus"),v.closeMenu("hover")},applyMobileBackgroundColor(e){if(!h.isDesktop&&h.isMenuOpen){const o=(e=>e.closest(m))(e);if(o){const i=(e=>{if(!e||"transparent"===e||"rgba(0, 0, 0, 0)"===e)return null;const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/);if(t){const[,e,n,s,o]=t;return{r:e,g:n,b:s,a:o||1}}return null})(window.getComputedStyle(o).backgroundColor);e.style.backgroundColor=i?(t=i.r,n=i.g,s=i.b,`rgba(${t}, ${n}, ${s}, ${a})`):r}}else e.style.backgroundColor="";var t,n,s},applyTopSpacing(e){const t=e.dataset.topSpacing;t&&parseInt(t)>0&&h.isDesktop?e.style.top=`${t}px`:h.isDesktop||(e.style.top="")},applyMenuWidth(e){if(g(e,"custom")){const t=e.dataset.customWidth;t&&parseInt(t)>0&&(e.style.width=`${t}px`,e.style.maxWidth=`${t}px`)}else(g(e,"content")||g(e,"wide")||g(e,"full"))&&(e.style.width="",e.style.maxWidth="")},determineJustification:(e,t)=>e.classList.contains("menu-justified-center")?"center":e.classList.contains("menu-justified-right")?"right":e.classList.contains("menu-justified-left")?"left":t.classList.contains("items-justified-center")||t.classList.contains("items-justified-space-between")?"center":t.classList.contains("items-justified-right")?"right":"left",getMenuMeasurements(e,t){const n=window.innerWidth;let s=e.offsetWidth;return g(e,"custom")&&e.dataset.customWidth&&(s=parseInt(e.dataset.customWidth)),{windowSpace:n,originalMenuWidth:s,menuRect:e.getBoundingClientRect(),navBlockRect:t.getBoundingClientRect(),leftOffset:t.getBoundingClientRect().left,leftSpace:(n-s)/2}},adjustMegaMenu(){const{ref:e}=t(),n=f(e);if(!n)return;const s=(e=>e.closest(p))(n);if(!s)return;v.applyTopSpacing(n),v.applyMobileBackgroundColor(n),v.applyMenuWidth(n);const o=v.determineJustification(n,s),i=v.getMenuMeasurements(n,s);v.applyJustificationPositioning(n,o,i.windowSpace,i.originalMenuWidth,i.menuRect,i.leftOffset,i.leftSpace,i.navBlockRect)},applyJustificationPositioning(e,t,n,s,o){const i=l;if(s>n){const t=Math.max(n,i);e.style.width=`${t}px`,s=t}if(g(e,"wide")||g(e,"full")){if("center"===t){const t=n/2-s/2-o.left,i=parseFloat(e.style.left||0)+t;e.style.left=`${i}px`}}else if("center"===t&&g(e,"custom")&&parseInt(e.dataset.customWidth)&&(e.style.left=`calc( ( -1 * ${s}px / 2 ) + 50% )`),g(e,"content")||g(e,"custom")){const o=e.getBoundingClientRect(),i=o.left,c=o.right;if(i<0||c>n)if("center"===t){let t=0;if(i<0?t=Math.abs(i):c>n&&(t=-(c-n)),g(e,"custom"))e.style.left=`calc( ( -1 * ${s}px / 2 ) + 50% + ${t}px )`;else{const n=parseFloat(e.style.left||window.getComputedStyle(e).left||0);e.style.left=`${n+t}px`}}else{let o=s,a=!1;if(i<0){const e=Math.abs(i);o=Math.min(o,s-e)}if(c>n){const e=c-n;o=Math.min(o,s-e)}if(a=o<u,a&&"true"!==e.dataset.justificationSwapped){const n="left"===t?"right":"left";return e.classList.remove("menu-justified-left","menu-justified-right","menu-justified-center"),e.classList.add(`menu-justified-${n}`),e.dataset.justificationSwapped="true",e.style.width="",e.style.left="",e.style.maxWidth="",v.adjustMegaMenu()}if(!a){const t=Math.max(o,l);e.style.width=`${t}px`}}}},handleResize(){const{ref:e}=t(),n=f(e);n&&(v.clearHoverTimeout(),!h.isDesktop&&h.menuOpenedBy.hover&&v.closeMenu("hover"),delete n.dataset.justificationSwapped,v.adjustMegaMenu(),h.isMenuOpen&&v.applyMobileBackgroundColor(n))},toggleMenuOnClick:o(n=>{const s=e(),{ref:o}=t();h.isProcessingClick=!0,s.showOnHover&&s.url&&h.isDesktop?h.isProcessingClick=!1:(n&&n.preventDefault&&n.preventDefault(),window.document.activeElement!==o&&o.focus(),h.menuOpenedBy.click?(v.closeMenu("click"),v.closeMenu("focus")):(v.closeMenu("focus"),s.previousFocus=o,v.openMenu("click")),setTimeout(()=>{h.isProcessingClick=!1},100))}),closeMenuOnClick(){v.closeMenu("click"),v.closeMenu("focus")},clearHoverTimeout(){h.hoverTimeout&&(clearTimeout(h.hoverTimeout),h.hoverTimeout=null)},setHoverTimeout(e,t){v.clearHoverTimeout(),h.hoverTimeout=setTimeout(s(e),t)},shouldActivateHover:()=>e().showOnHover&&h.isDesktop,handleMouseEnter(){v.shouldActivateHover()&&v.setHoverTimeout(()=>{h.menuOpenedBy.click||(M&&M!==e()&&(M.menuOpenedBy.hover=!1),M=e(),v.openMenu("hover"))},i)},handleMouseLeave(){v.shouldActivateHover()&&v.setHoverTimeout(()=>{v.closeMenu("hover")},h.dynamicHoverDelay)},handleMenuMouseEnter(){v.shouldActivateHover()&&v.clearHoverTimeout()},handleMenuMouseLeave(){v.shouldActivateHover()&&v.setHoverTimeout(()=>{v.closeMenu("hover")},i)},openMenuOnFocus(){h.isMenuOpen||h.isDesktop&&v.openMenu("focus")},handleMenuKeydown(e){(h.menuOpenedBy.click||h.menuOpenedBy.focus)&&"Escape"===e?.key&&(v.closeMenu("click"),v.closeMenu("focus"))},handleMenuFocusout(n){if(h.isProcessingClick)return;const s=e(),{ref:o}=t(),i=s.megaMenu?.querySelector(".wp-block-ollie-mega-menu__menu-container");n.relatedTarget&&(n.relatedTarget.classList?.contains("wp-block-navigation__responsive-close")||n.relatedTarget===o)||(null===n.relatedTarget||!i?.contains(n.relatedTarget)&&n.target!==window.document.activeElement)&&v.closeAllMenus()},openMenu(e="click"){h.menuOpenedBy[e]=!0},closeMenu(t="click"){const n=e();if(h.menuOpenedBy[t]=!1,!h.isMenuOpen){if(M===n&&(M=null),n.megaMenu?.contains(window.document.activeElement)&&n.previousFocus?.focus(),n.previousFocus=null,n.megaMenu){const e=f(n.megaMenu);e&&delete e.dataset.justificationSwapped}n.megaMenu=null}}},callbacks:{initMenu(){const n=e(),{ref:s}=t();if(h.isMenuOpen){n.megaMenu=s;const e=f(s);e&&v.applyMobileBackgroundColor(e)}},initMenuLayout(){v.adjustMegaMenu()}}});