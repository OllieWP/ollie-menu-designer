import{getContext as e,getElement as t,store as n,withScope as o}from"@wordpress/interactivity";const s=300,i=2,l=200,u=400,c=1,a="rgba(255, 255, 255, 1)",r=".wp-block-ollie-mega-menu__menu-container",d=".wp-block-navigation",p=".wp-block-navigation__responsive-container",m=e=>e.querySelector(r),f=(e,t)=>e.classList.contains({custom:"menu-width-custom",content:"menu-width-content",wide:"menu-width-wide",full:"menu-width-full"}[t]);let M=null;const{state:g,actions:h}=n("ollie/mega-menu",{state:{get isMenuOpen(){return Object.values(g.menuOpenedBy).filter(Boolean).length>0},get menuOpenedBy(){return e().menuOpenedBy},get isDesktop(){return window.innerWidth>=600},hoverTimeout:null,get dynamicHoverDelay(){const t=(e().topSpacing||0)*i;return s+t}},actions:{closeAllMenus(){h.closeMenu("click"),h.closeMenu("focus"),h.closeMenu("hover")},applyMobileBackgroundColor(e){if(!g.isDesktop&&g.isMenuOpen){const s=(e=>e.closest(p))(e);if(s){const i=(e=>{if(!e||"transparent"===e||"rgba(0, 0, 0, 0)"===e)return null;const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/);if(t){const[,e,n,o,s]=t;return{r:e,g:n,b:o,a:s||1}}return null})(window.getComputedStyle(s).backgroundColor);e.style.backgroundColor=i?(t=i.r,n=i.g,o=i.b,`rgba(${t}, ${n}, ${o}, ${c})`):a}}else e.style.backgroundColor="";var t,n,o},applyTopSpacing(e){const t=e.dataset.topSpacing;t&&parseInt(t)>0&&g.isDesktop?e.style.top=`${t}px`:g.isDesktop||(e.style.top="")},applyMenuWidth(e){if(f(e,"custom")){const t=e.dataset.customWidth;t&&parseInt(t)>0&&(e.style.width=`${t}px`,e.style.maxWidth=`${t}px`)}else(f(e,"content")||f(e,"wide")||f(e,"full"))&&(e.style.width="",e.style.maxWidth="")},determineJustification:(e,t)=>e.classList.contains("menu-justified-center")?"center":e.classList.contains("menu-justified-right")?"right":e.classList.contains("menu-justified-left")?"left":t.classList.contains("items-justified-center")||t.classList.contains("items-justified-space-between")?"center":t.classList.contains("items-justified-right")?"right":"left",getMenuMeasurements(e,t){const n=window.innerWidth;let o=e.offsetWidth;return f(e,"custom")&&e.dataset.customWidth&&(o=parseInt(e.dataset.customWidth)),{windowSpace:n,originalMenuWidth:o,menuRect:e.getBoundingClientRect(),navBlockRect:t.getBoundingClientRect(),leftOffset:t.getBoundingClientRect().left,leftSpace:(n-o)/2}},adjustMegaMenu(){const{ref:e}=t(),n=m(e);if(!n)return;const o=(e=>e.closest(d))(n);if(!o)return;h.applyTopSpacing(n),h.applyMobileBackgroundColor(n),h.applyMenuWidth(n);const s=h.determineJustification(n,o),i=h.getMenuMeasurements(n,o);h.applyJustificationPositioning(n,s,i.windowSpace,i.originalMenuWidth,i.menuRect,i.leftOffset,i.leftSpace,i.navBlockRect)},applyJustificationPositioning(e,t,n,o,s){const i=l;if(o>n){const t=Math.max(n,i);e.style.width=`${t}px`,o=t}if(f(e,"wide")||f(e,"full")){if("center"===t){const t=n/2-o/2-s.left,i=parseFloat(e.style.left||0)+t;e.style.left=`${i}px`}}else if("center"===t&&f(e,"custom")&&parseInt(e.dataset.customWidth)&&(e.style.left=`calc( ( -1 * ${o}px / 2 ) + 50% )`),f(e,"content")||f(e,"custom")){const s=e.getBoundingClientRect(),i=s.left,c=s.right;if(i<0||c>n)if("center"===t){let t=0;if(i<0?t=Math.abs(i):c>n&&(t=-(c-n)),f(e,"custom"))e.style.left=`calc( ( -1 * ${o}px / 2 ) + 50% + ${t}px )`;else{const n=parseFloat(e.style.left||window.getComputedStyle(e).left||0);e.style.left=`${n+t}px`}}else{let s=o,a=!1;if(i<0){const e=Math.abs(i);s=Math.min(s,o-e)}if(c>n){const e=c-n;s=Math.min(s,o-e)}if(a=s<u,a&&"true"!==e.dataset.justificationSwapped){const n="left"===t?"right":"left";return e.classList.remove("menu-justified-left","menu-justified-right","menu-justified-center"),e.classList.add(`menu-justified-${n}`),e.dataset.justificationSwapped="true",e.style.width="",e.style.left="",e.style.maxWidth="",h.adjustMegaMenu()}if(!a){const t=Math.max(s,l);e.style.width=`${t}px`}}}},handleResize(){const{ref:e}=t(),n=m(e);n&&(h.clearHoverTimeout(),!g.isDesktop&&g.menuOpenedBy.hover&&h.closeMenu("hover"),delete n.dataset.justificationSwapped,h.adjustMegaMenu(),g.isMenuOpen&&h.applyMobileBackgroundColor(n))},toggleMenuOnClick(n){const o=e(),{ref:s}=t();o.showOnHover&&o.url&&g.isDesktop||(n&&n.preventDefault&&n.preventDefault(),window.document.activeElement!==s&&s.focus(),g.menuOpenedBy.click||g.menuOpenedBy.focus?(h.closeMenu("click"),h.closeMenu("focus")):(o.previousFocus=s,h.openMenu("click")))},closeMenuOnClick(){h.closeMenu("click"),h.closeMenu("focus")},clearHoverTimeout(){g.hoverTimeout&&(clearTimeout(g.hoverTimeout),g.hoverTimeout=null)},setHoverTimeout(e,t){h.clearHoverTimeout(),g.hoverTimeout=setTimeout(o(e),t)},shouldActivateHover:()=>e().showOnHover&&g.isDesktop,handleMouseEnter(){h.shouldActivateHover()&&h.setHoverTimeout(()=>{g.menuOpenedBy.click||(M&&M!==e()&&(M.menuOpenedBy.hover=!1),M=e(),h.openMenu("hover"))},s)},handleMouseLeave(){h.shouldActivateHover()&&h.setHoverTimeout(()=>{h.closeMenu("hover")},g.dynamicHoverDelay)},handleMenuMouseEnter(){h.shouldActivateHover()&&h.clearHoverTimeout()},handleMenuMouseLeave(){h.shouldActivateHover()&&h.setHoverTimeout(()=>{h.closeMenu("hover")},s)},handleMenuKeydown(e){g.menuOpenedBy.click&&"Escape"===e?.key&&(h.closeMenu("click"),h.closeMenu("focus"))},handleMenuFocusout(t){const n=e(),o=n.megaMenu?.querySelector(".wp-block-ollie-mega-menu__menu-container");(null===t.relatedTarget||!o?.contains(t.relatedTarget)&&t.target!==window.document.activeElement)&&h.closeAllMenus()},openMenu(e="click"){g.menuOpenedBy[e]=!0},closeMenu(t="click"){const n=e();if(g.menuOpenedBy[t]=!1,!g.isMenuOpen){if(M===n&&(M=null),n.megaMenu?.contains(window.document.activeElement)&&n.previousFocus?.focus(),n.previousFocus=null,n.megaMenu){const e=m(n.megaMenu);e&&delete e.dataset.justificationSwapped}n.megaMenu=null}}},callbacks:{initMenu(){const n=e(),{ref:o}=t();if(g.isMenuOpen){n.megaMenu=o;const e=m(o);e&&h.applyMobileBackgroundColor(e)}},initMenuLayout(){h.adjustMegaMenu()}}});